<script>
// 烟花效果
const canvas = document.getElementById("fireworks");
const ctx = canvas.getContext("2d");
let particles = [];

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// 创建烟花
function createFirework(x, y) {
    const hue = Math.random() * 360; // 统一色相，像真实烟花那样同色系
    const particleCount = 120 + Math.random() * 60;
    for (let i = 0; i < particleCount; i++) {
        const angle = (Math.PI * 2 * i) / particleCount;
        const speed = Math.random() * 6 + 4;
        particles.push({
            x: x,
            y: y,
            speedX: Math.cos(angle) * speed,
            speedY: Math.sin(angle) * speed,
            radius: Math.random() * 3 + 1.5,
            alpha: 1,
            life: 1,
            color: `hsl(${hue + Math.random() * 20 - 10}, 100%, 60%)`,
            trail: []
        });
    }
}

// 绘制烟花
function drawFireworks() {
    // 半透明覆盖，制造拖尾效果
    ctx.fillStyle = "rgba(0, 0, 0, 0.2)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    particles.forEach((p, i) => {
        // 更新轨迹
        p.trail.push({ x: p.x, y: p.y, alpha: p.alpha });
        if (p.trail.length > 8) p.trail.shift();

        // 绘制拖尾
        for (let t = 0; t < p.trail.length; t++) {
            const point = p.trail[t];
            ctx.beginPath();
            ctx.globalAlpha = point.alpha * (t / p.trail.length);
            ctx.fillStyle = p.color;
            ctx.arc(point.x, point.y, p.radius * (t / p.trail.length), 0, Math.PI * 2);
            ctx.fill();
        }

        // 绘制主粒子带光晕
        ctx.beginPath();
        const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.radius * 4);
        gradient.addColorStop(0, p.color);
        gradient.addColorStop(1, "rgba(0,0,0,0)");
        ctx.fillStyle = gradient;
        ctx.globalAlpha = p.alpha;
        ctx.arc(p.x, p.y, p.radius * 4, 0, Math.PI * 2);
        ctx.fill();

        // 更新物理效果
        p.x += p.speedX;
        p.y += p.speedY;
        p.speedY += 0.05; // 重力
        p.alpha -= 0.012; // 衰减

        // 闪烁效果
        if (Math.random() < 0.05) p.alpha *= 0.9;

        // 移除消失的粒子
        if (p.alpha <= 0) particles.splice(i, 1);
    });

    ctx.globalAlpha = 1;
    requestAnimationFrame(drawFireworks);
}
drawFireworks();
</script>
